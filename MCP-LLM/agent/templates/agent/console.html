<!doctype html>
<html>
<head>
  <meta charset="utf-8"/>
  <title>PentestAgent Console</title>
  <style>
    body { font-family: monospace; background: #111; color: #eee; }
    #log { white-space: pre-wrap; background: #000; padding: 1rem; height: 70vh; overflow-y: auto; }
    input { width: 80%; padding: .5rem; }
    button { padding: .5rem 1rem; }
  </style>
</head>
<body>
  <h2>PentestAgent â€“ Live Console (MVP)</h2>
  <div>
    <input id="cmd" placeholder="e.g. nmap --version" />
    <button id="run">Run</button>
  </div>
  <div id="log"></div>

  <script>
    const log = document.getElementById("log");
    const ws = new WebSocket(`ws://${location.host}/ws/console/`);

    ws.onopen = () => append("[*] Connected\n");
    ws.onmessage = (e) => {
      const msg = JSON.parse(e.data);
      if (msg.type === "connected") append("[*] " + msg.msg + "\n");
      if (msg.type === "start") append(`\n$ ${msg.cmd}\n`);
      if (msg.type === "stream") append(`[${msg.stream}] ${msg.data}`);
      if (msg.type === "end") append(`\n[exit ${msg.exit_code}]\n`);
      if (msg.type === "error") append(`\n[error] ${msg.msg}\n`);
    };
    ws.onclose = () => append("[*] Disconnected\n");

    document.getElementById("run").onclick = () => {
      const cmd = document.getElementById("cmd").value.trim();
      if (!cmd) return;
      ws.send(JSON.stringify({cmd}));
    };

    function append(text) {
      log.textContent += text;
      log.scrollTop = log.scrollHeight;
    }
  </script>
</body>
</html>
